<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Carte concurrentielle â€“ Lâ€™Orange Bleue</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: Arial, Helvetica, sans-serif;
}

/* ===== MAP ===== */
#map {
  height: 100%;
  width: 100%;
}

/* ===== PANEL OVERLAY ===== */
#panel {
  position: fixed;
  top: 0;
  right: 0;
  width: 440px;
  height: 100%;
  background: #ffffff;
  box-shadow: -4px 0 15px rgba(0,0,0,0.3);
  padding: 20px;
  overflow-y: auto;
  display: none;
  z-index: 1000;
}

#panel h2 {
  margin-top: 0;
  color: #ff6a00;
}

.close-btn {
  float: right;
  border: none;
  background: none;
  font-size: 18px;
  cursor: pointer;
}

/* ===== BADGES ===== */
.badge {
  display: inline-block;
  padding: 6px 10px;
  margin: 6px 6px 6px 0;
  font-size: 12px;
  border-radius: 6px;
  background: #eee;
}

.inside { background: #c8f7c5; }
.outside { background: #f7c5c5; }

/* ===== TABLE ===== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 13px;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  vertical-align: top;
}

th {
  background: #ff6a00;
  color: white;
}

/* ===== LEGEND ===== */
#legend {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: white;
  padding: 12px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  font-size: 14px;
  z-index: 900;
}
</style>
</head>

<body>

<div id="map"></div>
<div id="panel"></div>

<div id="legend">
ðŸŸ  Lâ€™Orange Bleue<br>
ðŸŸ¢ Salle â‰¤ 2 km<br>
ðŸ”´ Salle > 2 km
</div>

<script>
/* ===== PARAMÃˆTRES ===== */
const ORANGE_BLEUE = { lat: 41.4305, lng: 2.1840 };
const RAYON = 2000;

/* ===== MAP ===== */
const map = L.map("map").setView([ORANGE_BLEUE.lat, ORANGE_BLEUE.lng], 13);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "Â© OpenStreetMap"
}).addTo(map);

// Orange Bleue
L.circleMarker([ORANGE_BLEUE.lat, ORANGE_BLEUE.lng], {
  radius: 10,
  fillColor: "#ff6a00",
  color: "#fff",
  weight: 2,
  fillOpacity: 1
}).addTo(map).bindTooltip("Lâ€™Orange Bleue");

// Zone 2 km
L.circle([ORANGE_BLEUE.lat, ORANGE_BLEUE.lng], {
  radius: RAYON,
  color: "#ff6a00",
  fillOpacity: 0.15
}).addTo(map);

/* ===== OUTILS ===== */
function distanceKm(lat, lng) {
  return (map.distance(
    [ORANGE_BLEUE.lat, ORANGE_BLEUE.lng],
    [lat, lng]
  ) / 1000).toFixed(2);
}

function closePanel() {
  document.getElementById("panel").style.display = "none";
}

function renderOffers(offers) {
  let html = `
    <table>
      <tr>
        <th>Formule</th>
        <th>Prix</th>
        <th>AccÃ¨s inclus</th>
        <th>Remarques</th>
      </tr>`;
  offers.forEach(o => {
    html += `
      <tr>
        <td>${o.formule}</td>
        <td>${o.prix}</td>
        <td>${o.acces}</td>
        <td>${o.remarque}</td>
      </tr>`;
  });
  html += "</table>";
  return html;
}

/* ===== DONNÃ‰ES SALLES (TOUTES) ===== */
const gyms = [
  {
    name:"Club Esports Fabra Gym",
    lat:41.4335,lng:2.1831,
    address:"Carrer de Sant Antoni Maria Claret, Barcelona",
    offers:[
      {formule:"Abonnement mensuel",prix:"â‰ˆ 50 â‚¬/mois",acces:"Musculation & fitness",remarque:"Indicatif"},
      {formule:"Abonnement trimestriel",prix:"Non communiquÃ©",acces:"Idem",remarque:"Ã€ demander"},
      {formule:"Abonnement annuel",prix:"Non communiquÃ©",acces:"Complet",remarque:"Plus avantageux"},
      {formule:"Frais dâ€™inscription",prix:"Variable",acces:"Carte",remarque:"Parfois offerts"},
      {formule:"Cours collectifs",prix:"Inclus / option",acces:"Selon formule",remarque:""},
      {formule:"AccÃ¨s libre",prix:"Inclus",acces:"Horaires dâ€™ouverture",remarque:""}
    ]
  },
  {
    name:"Nick Spa & Sport Club",
    lat:41.4388,lng:2.1864,
    address:"Carrer de Portugal, Barcelona",
    offers:[
      {formule:"AccÃ¨s limitÃ©",prix:"77,95 â‚¬/mois",acces:"Gym + spa",remarque:"CrÃ©neaux"},
      {formule:"AccÃ¨s libre",prix:"99,95 â‚¬/mois",acces:"Tout inclus",remarque:"Premium"}
    ]
  },
  {
    name:"VivaGym Meridiana",
    lat:41.4354,lng:2.1881,
    address:"Avinguda Meridiana, Barcelona",
    offers:[
      {formule:"Cuota ONE",prix:"29,90 â‚¬/mois",acces:"Club local",remarque:"Sans engagement"},
      {formule:"Cuota FLEX",prix:"34,90 â‚¬/mois",acces:"Zone",remarque:""},
      {formule:"Cuota PRIME",prix:"â‰ˆ 37 â‚¬/mois",acces:"Tous clubs",remarque:""}
    ]
  },
  {
    name:"VivaGym PegÃ s",
    lat:41.4317,lng:2.1916,
    address:"Carrer del PegÃ s, Barcelona",
    offers:[
      {formule:"Cuota ONE",prix:"29,90 â‚¬/mois",acces:"Club local",remarque:""},
      {formule:"Cuota FLEX",prix:"34,90 â‚¬/mois",acces:"Zone",remarque:""}
    ]
  },
  {
    name:"Entrena-T 24h Sant Andreu",
    lat:41.4361,lng:2.1889,
    address:"Sant Andreu, Barcelona",
    offers:[
      {formule:"Cuota mensual",prix:"47,90 â‚¬/mois",acces:"24h/24",remarque:""},
      {formule:"Cuota ahorro",prix:"39,92 â‚¬/mois",acces:"AccÃ¨s complet",remarque:"PrÃ©payÃ©"}
    ]
  },
  {
    name:"Cobosu Gym Station",
    lat:41.4282,lng:2.1813,
    address:"Riera dâ€™Horta, Barcelona",
    offers:[
      {formule:"Tarifs",prix:"Non publiÃ©s",acces:"â€”",remarque:"Contact direct"}
    ]
  }
];

/* ===== MARQUEURS ===== */
gyms.forEach(gym=>{
  const d = distanceKm(gym.lat,gym.lng);
  const inside = d<=2;

  L.circleMarker([gym.lat,gym.lng],{
    radius:8,
    fillColor:inside?"#2ecc71":"#e74c3c",
    color:"#fff",
    weight:2,
    fillOpacity:0.9
  })
  .addTo(map)
  .bindTooltip(gym.name)
  .on("click",()=>{
    document.getElementById("panel").innerHTML=`
      <button class="close-btn" onclick="closePanel()">âœ–</button>
      <h2>${gym.name}</h2>
      <p><strong>Adresse :</strong><br>${gym.address}</p>
      <span class="badge ${inside?"inside":"outside"}">
        ${inside?"Dans le pÃ©rimÃ¨tre (â‰¤ 2 km)":"Hors pÃ©rimÃ¨tre (> 2 km)"}
      </span>
      <p><strong>Distance :</strong> ${d} km</p>
      ${renderOffers(gym.offers)}
    `;
    document.getElementById("panel").style.display="block";
  });
});
</script>

</body>
</html>
